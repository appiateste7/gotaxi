<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administra√ß√£o - GoT√°xi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        
        header {
            background-color: #000;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
        }
        
        .logo span {
            color: #ffc107;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 20px;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        nav ul li a:hover {
            background-color: #333;
        }
        
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: calc(100vh - 60px);
            background-color: #f5f5f5;
        }
        
        .login-form {
            background-color: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 400px;
        }
        
        .login-form h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .login-btn {
            background-color: #ffc107;
            color: #000;
            border: none;
            padding: 15px;
            border-radius: 4px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.3s;
        }
        
        .login-btn:hover {
            background-color: #e0a800;
        }
        
        .error-message {
            color: #f44336;
            text-align: center;
            margin-top: 15px;
            display: none;
        }
        
        .admin-container {
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            display: none;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ffc107;
        }
        
        .admin-title {
            font-size: 28px;
            color: #333;
        }
        
        .logout-btn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .logout-btn:hover {
            background-color: #d32f2f;
        }
        
        /* PAINEL DE ESTAT√çSTICAS */
        .stats-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .stats-title {
            font-size: 24px;
            font-weight: bold;
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-number {
            font-size: 42px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .stat-label {
            font-size: 16px;
            color: #666;
            font-weight: 500;
        }
        
        .stat-icon {
            font-size: 40px;
            margin-bottom: 15px;
            display: block;
        }
        
        .refresh-btn {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-left: 10px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .refresh-btn:hover {
            background-color: #1976d2;
        }
        
        .reset-btn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .reset-btn:hover {
            background-color: #d32f2f;
        }
        
        .export-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-left: 10px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .export-btn:hover {
            background-color: #388E3C;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
            background: white;
            border-radius: 8px;
            padding: 5px;
        }
        
        .tab {
            padding: 12px 24px;
            background-color: #f5f5f5;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            min-width: 150px;
            text-align: center;
            border-radius: 4px;
            margin: 5px;
        }
        
        .tab.active {
            background-color: #ffc107;
            color: #000;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 10px;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .table-container {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #ddd;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #333;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        tr:hover {
            background-color: #f5f5f5;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 5px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .btn-block {
            background-color: #f44336;
            color: white;
        }
        
        .btn-unblock {
            background-color: #4CAF50;
            color: white;
        }
        
        .btn-delete {
            background-color: #ff5722;
            color: white;
        }
        
        .btn-view-credentials {
            background-color: #9c27b0;
            color: white;
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
        }
        
        .status-online {
            background-color: #4CAF50;
            color: white;
        }
        
        .status-offline {
            background-color: #9e9e9e;
            color: white;
        }
        
        .status-blocked {
            background-color: #f44336;
            color: white;
        }
        
        .status-pending {
            background-color: #ff9800;
            color: white;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }
        
        .date-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .date-filter input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-width: 200px;
            font-size: 14px;
        }
        
        .filter-btn {
            background-color: #ffc107;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .filter-btn:hover {
            background-color: #e0a800;
        }
        
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            border-radius: 25px;
            padding-left: 20px;
        }
        
        /* Modal para credenciais */
        .credentials-modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .credentials-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .credentials-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: #333;
            border-bottom: 2px solid #ffc107;
            padding-bottom: 10px;
        }
        
        .credentials-info {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .credential-item {
            margin-bottom: 15px;
        }
        
        .credential-label {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            display: block;
        }
        
        .credential-value {
            background-color: white;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-family: monospace;
            font-size: 14px;
            word-break: break-all;
        }
        
        .credentials-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn-close {
            background-color: #9e9e9e;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .btn-close:hover {
            background-color: #757575;
        }
        
        .btn-copy {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .btn-copy:hover {
            background-color: #1976d2;
        }
        
        .driver-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .scroll-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .update-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: 15px;
            font-size: 14px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-connected {
            background-color: #4CAF50;
            animation: pulse 2s infinite;
        }
        
        .status-disconnected {
            background-color: #f44336;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .last-update {
            font-size: 12px;
            color: rgba(255,255,255,0.8);
            margin-top: 10px;
            text-align: right;
        }
        
        .visits-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .stat-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            flex: 1;
            min-width: 200px;
        }
        
        .stat-box .number {
            font-size: 36px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .stat-box .label {
            font-size: 14px;
            color: #666;
        }
        
        .stat-box.primary {
            border-top: 4px solid #4CAF50;
        }
        
        .stat-box.warning {
            border-top: 4px solid #ff9800;
        }
        
        .stat-box.info {
            border-top: 4px solid #2196F3;
        }
        
        .stat-box.danger {
            border-top: 4px solid #f44336;
        }

        .ride-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-accepted {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .status-completed {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-cancelled {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .source-badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            margin-left: 5px;
        }
        
        .source-firebase {
            background-color: #4285f4;
            color: white;
        }
        
        .source-local {
            background-color: #fbbc05;
            color: black;
        }
        
        /* Estilos para visitas */
        .visits-counter {
            background-color: #2196F3;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .visit-device-icon {
            margin-right: 5px;
        }
        
        .visit-browser {
            font-size: 12px;
            color: #666;
            margin-top: 3px;
        }
        
        .visit-time-ago {
            font-size: 12px;
            color: #999;
            font-style: italic;
        }
        
        /* Bot√£o de visitas espec√≠fico */
        .visits-btn {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-left: 10px;
        }
        
        .visits-btn:hover {
            background-color: #1976d2;
        }

        /* CALEND√ÅRIO DE VISITAS */
        .calendar-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-nav {
            display: flex;
            gap: 10px;
        }
        
        .calendar-nav-btn {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .calendar-nav-btn:hover {
            background: #e9ecef;
        }
        
        .calendar-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .calendar-day {
            text-align: center;
            padding: 15px 5px;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            min-height: 60px;
        }
        
        .calendar-day:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .calendar-day.empty {
            background: #f8f9fa;
            cursor: default;
        }
        
        .calendar-day.empty:hover {
            background: #f8f9fa;
            transform: none;
            box-shadow: none;
        }
        
        .calendar-day.selected {
            background: #ffc107;
            color: #000;
            font-weight: bold;
            border-color: #ffc107;
        }
        
        .day-number {
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .day-visits {
            font-size: 12px;
            color: #666;
            position: absolute;
            bottom: 5px;
            left: 0;
            right: 0;
            text-align: center;
        }
        
        .day-visits.count {
            background: #2196F3;
            color: white;
            border-radius: 10px;
            padding: 2px 5px;
            display: inline-block;
            min-width: 20px;
        }
        
        /* RELAT√ìRIO DI√ÅRIO */
        .daily-report {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .daily-report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ffc107;
        }
        
        .daily-report-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        
        .daily-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .daily-stat {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .daily-stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 5px;
        }
        
        .daily-stat-label {
            font-size: 12px;
            color: #666;
        }
        
        .hourly-chart {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .hourly-chart-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .hourly-bars {
            display: flex;
            align-items: flex-end;
            height: 150px;
            gap: 2px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .hourly-bar {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .bar {
            width: 90%;
            border-radius: 3px 3px 0 0;
            background: linear-gradient(to top, #2196F3, #1976d2);
            min-height: 5px;
        }
        
        .hour-label {
            font-size: 10px;
            margin-top: 5px;
            color: #666;
        }
        
        .hour-count {
            font-size: 9px;
            color: #999;
            margin-top: 3px;
        }

        /* AUTO RESET INFO */
        .auto-reset-info {
            background: linear-gradient(135deg, #ff9800, #ff5722);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }
        
        .reset-timer {
            font-weight: bold;
            background: rgba(255,255,255,0.2);
            padding: 3px 8px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">Go<span>T√°xi</span> Admin</div>
        <nav>
            <ul>
                <li><a href="index.html">Voltar ao Site</a></li>
            </ul>
        </nav>
    </header>
    
    <!-- Tela de Login -->
    <div class="login-container" id="loginContainer">
        <div class="login-form">
            <h2>√Årea de Administra√ß√£o</h2>
            <div class="form-group">
                <label for="adminUsername">Usu√°rio</label>
                <input type="text" id="adminUsername" placeholder="Digite seu usu√°rio" value="Megaadm">
            </div>
            <div class="form-group">
                <label for="adminPassword">Senha</label>
                <input type="password" id="adminPassword" placeholder="Digite sua senha" value="12345">
            </div>
            <button class="login-btn" onclick="adminLogin()">Entrar</button>
            <div class="error-message" id="loginError">
                Usu√°rio ou senha incorretos!
            </div>
        </div>
    </div>
    
    <!-- √Årea Administrativa -->
    <div class="admin-container" id="adminContainer">
        <div class="admin-header">
            <h1 class="admin-title">Painel de Administra√ß√£o</h1>
            <div>
                <button class="refresh-btn" onclick="refreshData()">
                    üîÑ Atualizar Dados
                </button>
                <button class="visits-btn" onclick="openTab('visits')">
                    üìä Visitas
                </button>
                <button class="export-btn" onclick="exportData()">
                    üíæ Exportar Dados
                </button>
                <button class="logout-btn" onclick="adminLogout()">
                    Sair
                </button>
            </div>
        </div>
        
        <!-- Status de Conex√£o -->
        <div class="update-status">
            <span class="status-indicator status-connected" id="connectionStatus"></span>
            <span id="connectionText">Conectado ao Firebase</span>
        </div>
        
        <!-- Informa√ß√£o de Reset Autom√°tico -->
        <div class="auto-reset-info" id="autoResetInfo">
            <div>üîÑ <strong>Reset Autom√°tico:</strong> Contador de visitas do dia ser√° zerado automaticamente √† meia-noite</div>
            <div class="reset-timer" id="resetTimer">--:--:--</div>
        </div>
        
        <!-- PAINEL DE ESTAT√çSTICAS DE VISITAS -->
        <div class="stats-panel" id="statsPanel">
            <div class="stats-header">
                <div class="stats-title">
                    üìä Estat√≠sticas do Sistema
                </div>
                <div class="last-update" id="lastUpdate">
                    √öltima atualiza√ß√£o: --
                </div>
            </div>
            
            <div class="visits-stats">
                <div class="stat-box primary">
                    <div class="number" id="totalVisitsStat">0</div>
                    <div class="label">Total de Visitas</div>
                </div>
                <div class="stat-box warning">
                    <div class="number" id="todayVisitsStat">0</div>
                    <div class="label">Visitas Hoje</div>
                </div>
                <div class="stat-box info">
                    <div class="number" id="totalDriversStat">0</div>
                    <div class="label">Motoristas Cadastrados</div>
                </div>
                <div class="stat-box danger">
                    <div class="number" id="activeDriversStat">0</div>
                    <div class="label">Motoristas Online</div>
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="openTab('visits')">üë• Visitas</button>
            <button class="tab" onclick="openTab('calendar')">üìÖ Calend√°rio</button>
            <button class="tab" onclick="openTab('drivers')">üë®‚Äç‚úàÔ∏è Motoristas</button>
            <button class="tab" onclick="openTab('rides')">üöï Corridas</button>
            <button class="tab" onclick="openTab('registrations')">üìù Registros</button>
            <button class="tab" onclick="openTab('realtime')">‚ö° Tempo Real</button>
        </div>
        
        <!-- Aba de Visitas -->
        <div class="tab-content active" id="visitsTab">
            <div class="date-filter">
                <label for="dateFilter">Filtrar por data:</label>
                <input type="date" id="dateFilter">
                <button class="filter-btn" onclick="filterVisits()">Filtrar</button>
                <button class="filter-btn" onclick="resetVisitFilter()">Hoje</button>
                <button class="filter-btn" onclick="showAllVisits()">Ver Todas</button>
                <button class="reset-btn" onclick="resetVisitStats()">üîÑ Resetar Estat√≠sticas</button>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Data/Hora</th>
                            <th>Dispositivo</th>
                            <th>Idioma</th>
                            <th>P√°gina</th>
                            <th>Navegador</th>
                            <th>Resolu√ß√£o</th>
                        </tr>
                    </thead>
                    <tbody id="visitsTable">
                        <tr>
                            <td colspan="6" class="no-data">Carregando dados de visitas...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Aba de Calend√°rio -->
        <div class="tab-content" id="calendarTab">
            <div class="calendar-container">
                <div class="calendar-header">
                    <div class="calendar-nav">
                        <button class="calendar-nav-btn" onclick="changeMonth(-1)">‚Üê M√™s Anterior</button>
                        <button class="calendar-nav-btn" onclick="goToToday()">Hoje</button>
                        <button class="calendar-nav-btn" onclick="changeMonth(1)">Pr√≥ximo M√™s ‚Üí</button>
                    </div>
                    <div class="calendar-title" id="calendarTitle">Carregando...</div>
                </div>
                
                <div class="calendar-grid">
                    <!-- Cabe√ßalhos dos dias -->
                    <div class="calendar-day-header">Dom</div>
                    <div class="calendar-day-header">Seg</div>
                    <div class="calendar-day-header">Ter</div>
                    <div class="calendar-day-header">Qua</div>
                    <div class="calendar-day-header">Qui</div>
                    <div class="calendar-day-header">Sex</div>
                    <div class="calendar-day-header">S√°b</div>
                    
                    <!-- Dias ser√£o inseridos aqui -->
                    <div id="calendarDays"></div>
                </div>
            </div>
            
            <div class="daily-report" id="dailyReport">
                <div class="daily-report-header">
                    <div class="daily-report-title" id="selectedDateTitle">Selecione uma data no calend√°rio</div>
                </div>
                <div id="dailyReportContent">
                    <p style="text-align: center; color: #666; padding: 40px 0;">
                        Clique em um dia no calend√°rio para ver o relat√≥rio detalhado
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Aba de Motoristas -->
        <div class="tab-content" id="driversTab">
            <div class="date-filter">
                <button class="filter-btn" onclick="searchAllDrivers()">
                    üîç Buscar Todos os Motoristas
                </button>
                <button class="filter-btn" onclick="showPasswordDrivers()">
                    üîë Motoristas com Senha
                </button>
                <button class="export-btn" onclick="exportDrivers()">
                    üì• Exportar Motoristas
                </button>
            </div>
            <div class="search-box">
                <input type="text" id="driverSearch" placeholder="Buscar motorista por nome, usu√°rio, matr√≠cula ou telefone..." onkeyup="searchDrivers()">
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Usu√°rio</th>
                            <th>Telefone</th>
                            <th>Matr√≠cula</th>
                            <th>Status</th>
                            <th>Fonte</th>
                            <th>Data de Cadastro</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="driversTable">
                        <tr>
                            <td colspan="8" class="no-data">Carregando dados de motoristas...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Aba de Corridas -->
        <div class="tab-content" id="ridesTab">
            <div class="date-filter">
                <label for="rideDateFilter">Filtrar por data:</label>
                <input type="date" id="rideDateFilter">
                <button class="filter-btn" onclick="filterRides()">Filtrar</button>
                <button class="filter-btn" onclick="resetRideFilter()">Hoje</button>
                <button class="filter-btn" onclick="showAllRides()">Todas</button>
                <select id="rideStatusFilter" onchange="filterRidesByStatus()" style="padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="all">Todos os Status</option>
                    <option value="pending">Pendentes</option>
                    <option value="accepted">Aceitas</option>
                    <option value="completed">Completadas</option>
                    <option value="cancelled">Canceladas</option>
                </select>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Telefone</th>
                            <th>Motorista</th>
                            <th>Origem</th>
                            <th>Destino</th>
                            <th>Data/Hora</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="ridesTable">
                        <tr>
                            <td colspan="8" class="no-data">Carregando dados de corridas...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Aba de Registros -->
        <div class="tab-content" id="registrationsTab">
            <div class="search-box">
                <input type="text" id="registrationSearch" placeholder="Buscar registros por nome, usu√°rio ou matr√≠cula..." onkeyup="searchRegistrations()">
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Data/Hora</th>
                            <th>Nome</th>
                            <th>Usu√°rio</th>
                            <th>Telefone</th>
                            <th>Matr√≠cula</th>
                            <th>NIF</th>
                            <th>Dispositivo</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="registrationsTable">
                        <tr>
                            <td colspan="8" class="no-data">Carregando registros recentes...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Aba de Tempo Real -->
        <div class="tab-content" id="realtimeTab">
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="margin-bottom: 15px; color: #333;">Visitas em Tempo Real</h3>
                <div id="realtimeVisits">
                    <p>üîÑ Aguardando visitas em tempo real...</p>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <h4 style="margin-bottom: 15px; color: #333;">Visitas por Hora (Hoje)</h4>
                    <div id="hourlyChart" style="height: 200px;">
                        <p style="text-align: center; color: #666; padding: 40px 0;">Gr√°fico carregando...</p>
                    </div>
                </div>
                
                <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <h4 style="margin-bottom: 15px; color: #333;">Dispositivos dos Visitantes</h4>
                    <div id="deviceChart" style="height: 200px;">
                        <p style="text-align: center; color: #666; padding: 40px 0;">Gr√°fico carregando...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Credenciais -->
    <div id="credentialsModal" class="credentials-modal">
        <div class="credentials-content">
            <h3 class="credentials-title">üìã Credenciais do Motorista</h3>
            <div class="credentials-info" id="credentialsInfo">
                <div class="credential-item">
                    <div class="credential-label">Nome:</div>
                    <div class="credential-value" id="credentialName">--</div>
                </div>
                <div class="credential-item">
                    <div class="credential-label">Usu√°rio:</div>
                    <div class="credential-value" id="credentialUsername">--</div>
                </div>
                <div class="credential-item">
                    <div class="credential-label">Telefone:</div>
                    <div class="credential-value" id="credentialPhone">--</div>
                </div>
                <div class="credential-item">
                    <div class="credential-label">Senha:</div>
                    <div class="credential-value" id="credentialPassword">--</div>
                </div>
                <div class="credential-item">
                    <div class="credential-label">Data de Cadastro:</div>
                    <div class="credential-value" id="credentialDate">--</div>
                </div>
                <div class="credential-item">
                    <div class="credential-label">Fonte:</div>
                    <div class="credential-value" id="credentialSource">--</div>
                </div>
            </div>
            <div class="credentials-buttons">
                <button class="btn-copy" onclick="copyCredentials()">üìã Copiar Credenciais</button>
                <button class="btn-close" onclick="closeCredentialsModal()">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <script>
        // Configura√ß√£o do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAZ4YqmOZz0wUlhBvuSD_fBLcwq1av8yc8",
            authDomain: "gotaxi-4e391.firebaseapp.com",
            databaseURL: "https://gotaxi-4e391-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "gotaxi-4e391",
            storageBucket: "gotaxi-4e391.firebasestorage.app",
            messagingSenderId: "597857194128",
            appId: "1:597857194128:web:9b550abd9b5e98bb374815"
        };
        
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Credenciais do administrador
        const ADMIN_CREDENTIALS = {
            username: 'Megaadm',
            password: '12345'
        };
        
        // Vari√°veis globais
        let isAdminLoggedIn = false;
        let allDrivers = {};
        let allRides = [];
        let allRegistrations = [];
        let allVisits = [];
        let dailyStats = {};
        let refreshInterval = null;
        let midnightResetInterval = null;
        let currentCredentials = {};
        let currentCalendarDate = new Date();
        let selectedCalendarDate = null;

        // Verificar se o admin est√° logado
        function checkAdminLogin() {
            const savedLogin = localStorage.getItem('adminLoggedIn');
            if (savedLogin === 'true') {
                isAdminLoggedIn = true;
                showAdminPanel();
            }
        }

        // Login do administrador
        function adminLogin() {
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            const loginError = document.getElementById('loginError');
            
            if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
                isAdminLoggedIn = true;
                localStorage.setItem('adminLoggedIn', 'true');
                showAdminPanel();
                loginError.style.display = 'none';
            } else {
                loginError.style.display = 'block';
            }
        }

        // Logout do administrador
        function adminLogout() {
            isAdminLoggedIn = false;
            localStorage.removeItem('adminLoggedIn');
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('adminContainer').style.display = 'none';
            document.getElementById('adminUsername').value = '';
            document.getElementById('adminPassword').value = '';
            
            if (refreshInterval) {
                clearInterval(refreshInterval);
                refreshInterval = null;
            }
            
            if (midnightResetInterval) {
                clearInterval(midnightResetInterval);
                midnightResetInterval = null;
            }
        }

        // Mostrar painel administrativo
        function showAdminPanel() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('adminContainer').style.display = 'block';
            
            loadAllData();
            startRealtimeMonitoring();
            startMidnightResetTimer();
            
            refreshInterval = setInterval(() => {
                loadStats();
                loadVisitsData();
            }, 30000); // Atualizar a cada 30 segundos
        }

        // Iniciar timer para reset √† meia-noite
        function startMidnightResetTimer() {
            updateResetTimer();
            midnightResetInterval = setInterval(updateResetTimer, 1000);
            
            // Verificar se precisa resetar as visitas de hoje
            checkAndResetDailyVisits();
        }

        // Atualizar contador para reset
        function updateResetTimer() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            
            const diff = tomorrow - now;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('resetTimer').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Se for meia-noite, resetar contador
            if (hours === 0 && minutes === 0 && seconds === 0) {
                resetDailyVisits();
            }
        }

        // Verificar e resetar visitas di√°rias se necess√°rio
        async function checkAndResetDailyVisits() {
            try {
                const statsSnapshot = await database.ref('visits_stats').once('value');
                const stats = statsSnapshot.val() || {};
                
                if (stats.lastResetDate) {
                    const lastReset = new Date(stats.lastResetDate);
                    const today = new Date();
                    
                    // Verificar se o √∫ltimo reset foi antes de hoje
                    if (lastReset.toDateString() !== today.toDateString()) {
                        await resetDailyVisits();
                    }
                } else {
                    // Se n√£o existe data de reset, criar
                    await database.ref('visits_stats').update({
                        lastResetDate: new Date().toISOString()
                    });
                }
            } catch (error) {
                console.error('Erro ao verificar reset di√°rio:', error);
            }
        }

        // Resetar visitas do dia
        async function resetDailyVisits() {
            try {
                console.log('üîÑ Resetando contador de visitas do dia (meia-noite)');
                
                const statsSnapshot = await database.ref('visits_stats').once('value');
                let stats = statsSnapshot.val() || {};
                
                // Salvar estat√≠sticas do dia anterior
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayKey = yesterday.toISOString().split('T')[0];
                
                const dailyStats = {
                    visits: stats.todayVisits || 0,
                    date: yesterdayKey,
                    resetTime: new Date().toISOString()
                };
                
                // Salvar estat√≠sticas do dia anterior
                await database.ref(`daily_history/${yesterdayKey}`).set(dailyStats);
                
                // Resetar contador de hoje
                const updatedStats = {
                    ...stats,
                    todayVisits: 0,
                    lastResetDate: new Date().toISOString(),
                    lastUpdate: new Date().toISOString()
                };
                
                await database.ref('visits_stats').set(updatedStats);
                
                // Atualizar display
                document.getElementById('todayVisitsStat').textContent = '0';
                
                // Recarregar dados
                await loadDailyStats();
                await loadCalendarData();
                
                showNotification('‚úÖ Contador de visitas do dia resetado automaticamente (meia-noite)', true);
                
            } catch (error) {
                console.error('Erro ao resetar visitas di√°rias:', error);
            }
        }

        // Carregar todos os dados
        async function loadAllData() {
            try {
                await loadStats();
                await loadDailyStats();
                await loadVisitsData();
                await loadDriversData();
                await loadRidesData();
                await loadRegistrationsData();
                updateRealtimeCharts();
                await loadCalendarData();
            } catch (error) {
                console.error('Erro geral ao carregar dados:', error);
                showNotification('Erro ao carregar dados!', false);
            }
        }

        // Atualizar dados
        async function refreshData() {
            showNotification('Atualizando dados...', false);
            await loadAllData();
            showNotification('Dados atualizados com sucesso!', true);
        }

        // Carregar estat√≠sticas
        async function loadStats() {
            try {
                // Carregar estat√≠sticas de visitas
                const statsSnapshot = await database.ref('visits_stats').once('value');
                let stats = statsSnapshot.val();
                
                // Se n√£o existir, criar estrutura inicial
                if (!stats) {
                    stats = {
                        totalVisits: 0,
                        todayVisits: 0,
                        uniqueVisitors: 0,
                        lastUpdate: new Date().toISOString(),
                        lastResetDate: new Date().toISOString()
                    };
                    await database.ref('visits_stats').set(stats);
                }
                
                // Atualizar display de visitas
                document.getElementById('totalVisitsStat').textContent = stats.totalVisits || 0;
                document.getElementById('todayVisitsStat').textContent = stats.todayVisits || 0;
                
                // Carregar motoristas do Firebase
                const driversSnapshot = await database.ref('drivers_registered').once('value');
                const firebaseDrivers = driversSnapshot.val() || {};
                document.getElementById('totalDriversStat').textContent = Object.keys(firebaseDrivers).length;
                
                // Carregar motoristas online
                const onlineSnapshot = await database.ref('drivers').once('value');
                const onlineDrivers = onlineSnapshot.val() || {};
                const activeDrivers = Object.values(onlineDrivers).filter(driver => driver.status === 'online').length;
                document.getElementById('activeDriversStat').textContent = activeDrivers;
                
                // Atualizar timestamp
                const lastUpdate = stats.lastUpdate ? new Date(stats.lastUpdate) : new Date();
                document.getElementById('lastUpdate').textContent = 
                    `√öltima atualiza√ß√£o: ${lastUpdate.toLocaleTimeString('pt-PT')}`;
                
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas:', error);
                showNotification('Erro ao carregar estat√≠sticas!', false);
            }
        }

        // Carregar estat√≠sticas di√°rias
        async function loadDailyStats() {
            try {
                const dailySnapshot = await database.ref('daily_history').once('value');
                dailyStats = dailySnapshot.val() || {};
                console.log(`üìÖ ${Object.keys(dailyStats).length} dias com hist√≥rico carregados`);
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas di√°rias:', error);
                dailyStats = {};
            }
        }

        // Carregar dados das visitas
        async function loadVisitsData() {
            try {
                console.log('üìä Carregando dados de visitas...');
                
                // Buscar todas as visitas do Firebase
                const visitsSnapshot = await database.ref('visits').orderByChild('timestamp').limitToLast(100).once('value');
                const visitsData = visitsSnapshot.val() || {};
                
                // Converter para array
                allVisits = Object.entries(visitsData)
                    .map(([id, visit]) => ({
                        id,
                        ...visit
                    }))
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                console.log(`‚úÖ ${allVisits.length} visitas carregadas`);
                
                // Atualizar tabela
                updateVisitsTable(allVisits);
                
                // Atualizar estat√≠sticas em tempo real
                updateRealtimeVisits();
                
            } catch (error) {
                console.error('‚ùå ERRO ao carregar visitas:', error);
                showNotification('Erro ao carregar visitas!', false);
                
                // Mostrar mensagem amig√°vel
                const tableBody = document.getElementById('visitsTable');
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="no-data">
                            Erro ao carregar visitas. <br>
                            <small>Tente recarregar a p√°gina.</small>
                        </td>
                    </tr>
                `;
            }
        }

        // Atualizar tabela de visitas
        function updateVisitsTable(visits) {
            const tableBody = document.getElementById('visitsTable');
            tableBody.innerHTML = '';
            
            if (!visits || visits.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="no-data">Nenhuma visita registrada ainda</td>
                    </tr>
                `;
                return;
            }
            
            visits.forEach(visit => {
                try {
                    // Tratamento seguro da data
                    let formattedDate = 'Data inv√°lida';
                    let timeAgo = '';
                    try {
                        const visitDate = new Date(visit.timestamp);
                        if (!isNaN(visitDate.getTime())) {
                            formattedDate = visitDate.toLocaleString('pt-PT');
                            timeAgo = getTimeAgo(visitDate);
                        }
                    } catch (e) {
                        console.warn('Erro ao formatar data:', e);
                    }
                    
                    // Detectar dispositivo
                    let device = 'Desktop';
                    let deviceIcon = 'üíª';
                    if (visit.isMobile === true || (typeof visit.isMobile === 'string' && visit.isMobile.toLowerCase() === 'true')) {
                        device = 'Mobile';
                        deviceIcon = 'üì±';
                    }
                    
                    // Detectar navegador
                    let browser = 'Desconhecido';
                    if (visit.userAgent) {
                        if (visit.userAgent.includes('Chrome')) browser = 'Chrome';
                        else if (visit.userAgent.includes('Firefox')) browser = 'Firefox';
                        else if (visit.userAgent.includes('Safari')) browser = 'Safari';
                        else if (visit.userAgent.includes('Edge')) browser = 'Edge';
                    }
                    
                    // P√°gina visitada
                    const page = visit.page || 'index.html';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            ${formattedDate}
                            <div class="visit-time-ago">${timeAgo}</div>
                        </td>
                        <td>
                            <span class="visit-device-icon">${deviceIcon}</span> ${device}
                        </td>
                        <td>${visit.language || 'pt-PT'}</td>
                        <td>${page}</td>
                        <td>
                            ${browser}
                            <div class="visit-browser">${visit.screenResolution || 'N√£o detectada'}</div>
                        </td>
                        <td>${visit.timezone || 'UTC'}</td>
                    `;
                    tableBody.appendChild(row);
                    
                } catch (error) {
                    console.error('Erro ao processar visita:', visit, error);
                }
            });
        }

        // Calcular tempo relativo
        function getTimeAgo(date) {
            try {
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                
                if (diffMins < 1) return 'Agora mesmo';
                if (diffMins === 1) return 'H√° 1 minuto';
                if (diffMins < 60) return `H√° ${diffMins} minutos`;
                
                const diffHours = Math.floor(diffMins / 60);
                if (diffHours === 1) return 'H√° 1 hora';
                if (diffHours < 24) return `H√° ${diffHours} horas`;
                
                const diffDays = Math.floor(diffHours / 24);
                if (diffDays === 1) return 'Ontem';
                if (diffDays < 7) return `H√° ${diffDays} dias`;
                
                const diffWeeks = Math.floor(diffDays / 7);
                if (diffWeeks === 1) return 'H√° 1 semana';
                return `H√° ${diffWeeks} semanas`;
            } catch (e) {
                return 'Recentemente';
            }
        }

        // Filtrar visitas por data
        function filterVisits() {
            const dateFilter = document.getElementById('dateFilter').value;
            if (!dateFilter) {
                updateVisitsTable(allVisits);
                return;
            }
            
            const targetDate = new Date(dateFilter);
            const filteredVisits = allVisits.filter(visit => {
                try {
                    const visitDate = new Date(visit.timestamp);
                    return visitDate.toDateString() === targetDate.toDateString();
                } catch (e) {
                    return false;
                }
            });
            
            updateVisitsTable(filteredVisits);
        }

        // Resetar filtro de visitas
        function resetVisitFilter() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateFilter').value = today;
            filterVisits();
        }

        // Mostrar todas as visitas
        function showAllVisits() {
            document.getElementById('dateFilter').value = '';
            updateVisitsTable(allVisits);
        }

        // Resetar estat√≠sticas de visitas
        async function resetVisitStats() {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO!\n\nTem certeza que deseja resetar TODAS as estat√≠sticas de visitas?\n\nEsta a√ß√£o N√ÉO pode ser desfeita e todos os dados ser√£o perdidos permanentemente.')) {
                try {
                    showNotification('Resetando estat√≠sticas...', false);
                    
                    // Remover todas as visitas
                    await database.ref('visits').remove();
                    
                    // Remover hist√≥rico di√°rio
                    await database.ref('daily_history').remove();
                    
                    // Resetar estat√≠sticas
                    const resetStats = {
                        totalVisits: 0,
                        todayVisits: 0,
                        uniqueVisitors: 0,
                        lastUpdate: new Date().toISOString(),
                        lastResetDate: new Date().toISOString()
                    };
                    
                    await database.ref('visits_stats').set(resetStats);
                    
                    // Limpar arrays locais
                    allVisits = [];
                    dailyStats = {};
                    
                    // Atualizar tabelas
                    updateVisitsTable([]);
                    updateCalendar();
                    
                    // Atualizar display
                    document.getElementById('totalVisitsStat').textContent = '0';
                    document.getElementById('todayVisitsStat').textContent = '0';
                    
                    showNotification('Estat√≠sticas resetadas com sucesso!', true);
                    
                } catch (error) {
                    console.error('Erro ao resetar estat√≠sticas:', error);
                    showNotification('Erro ao resetar estat√≠sticas!', false);
                }
            }
        }

        // Atualizar visitas em tempo real
        function updateRealtimeVisits() {
            const container = document.getElementById('realtimeVisits');
            
            // Pegar as √∫ltimas 5 visitas
            const recentVisits = [...allVisits].slice(0, 5);
            
            if (recentVisits.length === 0) {
                container.innerHTML = '<p>üîÑ Nenhuma visita recente registrada</p>';
                return;
            }
            
            let html = '<h4>√öltimas 5 visitas:</h4>';
            recentVisits.forEach(visit => {
                try {
                    const visitDate = new Date(visit.timestamp);
                    const timeAgo = getTimeAgo(visitDate);
                    const deviceIcon = visit.isMobile ? 'üì±' : 'üíª';
                    
                    html += `
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 8px; border-left: 3px solid #2196F3;">
                            <div style="font-weight: bold;">
                                ${deviceIcon} ${visit.isMobile ? 'Mobile' : 'Desktop'} 
                                <span style="color: #666; font-size: 12px; margin-left: 10px;">${visit.language || 'pt-PT'}</span>
                            </div>
                            <div style="font-size: 12px; color: #666;">
                                ${timeAgo} ‚Ä¢ ${visitDate.toLocaleTimeString('pt-PT')}
                            </div>
                        </div>
                    `;
                } catch (e) {
                    console.warn('Erro ao processar visita em tempo real:', visit, e);
                }
            });
            
            container.innerHTML = html;
        }

        // ==================== CALEND√ÅRIO ====================
        
        // Carregar dados do calend√°rio
        async function loadCalendarData() {
            await loadDailyStats();
            updateCalendar();
        }
        
        // Atualizar calend√°rio
        function updateCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // Atualizar t√≠tulo
            const monthNames = [
                'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];
            
            document.getElementById('calendarTitle').textContent = 
                `${monthNames[month]} ${year}`;
            
            // Obter primeiro dia do m√™s
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            // Obter dia da semana do primeiro dia (0 = Domingo, 1 = Segunda, etc.)
            const firstDayOfWeek = firstDay.getDay();
            
            // Obter n√∫mero de dias no m√™s
            const daysInMonth = lastDay.getDate();
            
            // Obter dia atual
            const today = new Date();
            const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;
            
            // Limpar calend√°rio
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            // Adicionar c√©lulas vazias para dias antes do primeiro dia do m√™s
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'calendar-day empty';
                calendarDays.appendChild(emptyCell);
            }
            
            // Adicionar dias do m√™s
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';
                
                // Criar chave para a data no formato YYYY-MM-DD
                const dateKey = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                
                // Verificar se √© o dia atual
                const isToday = isCurrentMonth && day === today.getDate();
                if (isToday) {
                    dayCell.style.border = '2px solid #4CAF50';
                }
                
                // Verificar se √© o dia selecionado
                if (selectedCalendarDate === dateKey) {
                    dayCell.classList.add('selected');
                }
                
                // Obter n√∫mero de visitas para este dia
                const dayVisits = dailyStats[dateKey] ? dailyStats[dateKey].visits : 0;
                
                // Adicionar conte√∫do
                dayCell.innerHTML = `
                    <div class="day-number">${day}</div>
                    ${dayVisits > 0 ? 
                        `<div class="day-visits">
                            <span class="day-visits count">${dayVisits}</span>
                        </div>` : 
                        ''
                    }
                `;
                
                // Adicionar evento de clique
                dayCell.onclick = () => selectCalendarDay(dateKey, day, month, year);
                
                calendarDays.appendChild(dayCell);
            }
        }
        
        // Selecionar dia no calend√°rio
        async function selectCalendarDay(dateKey, day, month, year) {
            selectedCalendarDate = dateKey;
            
            // Atualizar visual do calend√°rio
            document.querySelectorAll('.calendar-day').forEach(cell => {
                cell.classList.remove('selected');
            });
            
            event.target.classList.add('selected');
            
            // Atualizar t√≠tulo
            const monthNames = [
                'Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'
            ];
            
            document.getElementById('selectedDateTitle').textContent = 
                `Relat√≥rio de Visitas - ${day} de ${monthNames[month]} de ${year}`;
            
            // Carregar dados do dia selecionado
            await loadDayReport(dateKey);
        }
        
        // Carregar relat√≥rio do dia
        async function loadDayReport(dateKey) {
            try {
                // Buscar visitas do dia espec√≠fico
                const startDate = new Date(dateKey);
                startDate.setHours(0, 0, 0, 0);
                
                const endDate = new Date(dateKey);
                endDate.setHours(23, 59, 59, 999);
                
                // Buscar visitas do Firebase
                const visitsSnapshot = await database.ref('visits')
                    .orderByChild('timestamp')
                    .startAt(startDate.toISOString())
                    .endAt(endDate.toISOString())
                    .once('value');
                
                const dayVisits = visitsSnapshot.val() || {};
                const visitsArray = Object.values(dayVisits);
                
                // Calcular estat√≠sticas
                let mobileCount = 0;
                let desktopCount = 0;
                let chromeCount = 0;
                let firefoxCount = 0;
                let safariCount = 0;
                let edgeCount = 0;
                let otherBrowserCount = 0;
                
                // Visitas por hora
                const visitsByHour = Array(24).fill(0);
                
                visitsArray.forEach(visit => {
                    try {
                        // Contar dispositivos
                        if (visit.isMobile === true || (typeof visit.isMobile === 'string' && visit.isMobile.toLowerCase() === 'true')) {
                            mobileCount++;
                        } else {
                            desktopCount++;
                        }
                        
                        // Contar navegadores
                        if (visit.userAgent) {
                            if (visit.userAgent.includes('Chrome')) chromeCount++;
                            else if (visit.userAgent.includes('Firefox')) firefoxCount++;
                            else if (visit.userAgent.includes('Safari')) safariCount++;
                            else if (visit.userAgent.includes('Edge')) edgeCount++;
                            else otherBrowserCount++;
                        }
                        
                        // Contar por hora
                        const visitDate = new Date(visit.timestamp);
                        if (!isNaN(visitDate.getTime())) {
                            const hour = visitDate.getHours();
                            visitsByHour[hour]++;
                        }
                    } catch (e) {
                        console.warn('Erro ao processar visita para relat√≥rio:', e);
                    }
                });
                
                // Obter estat√≠sticas salvas
                const savedStats = dailyStats[dateKey] || { visits: 0 };
                
                // Gerar HTML do relat√≥rio
                let html = `
                    <div class="daily-stats">
                        <div class="daily-stat">
                            <div class="daily-stat-number">${visitsArray.length}</div>
                            <div class="daily-stat-label">Total de Visitas</div>
                        </div>
                        <div class="daily-stat">
                            <div class="daily-stat-number">${mobileCount}</div>
                            <div class="daily-stat-label">Dispositivos Mobile</div>
                        </div>
                        <div class="daily-stat">
                            <div class="daily-stat-number">${desktopCount}</div>
                            <div class="daily-stat-label">Dispositivos Desktop</div>
                        </div>
                        <div class="daily-stat">
                            <div class="daily-stat-number">${savedStats.visits || 0}</div>
                            <div class="daily-stat-label">Visitas Salvas</div>
                        </div>
                    </div>
                `;
                
                // Adicionar gr√°fico de visitas por hora
                html += `
                    <div class="hourly-chart">
                        <div class="hourly-chart-title">Visitas por Hora</div>
                        <div class="hourly-bars">
                `;
                
                for (let hour = 0; hour < 24; hour++) {
                    const count = visitsByHour[hour] || 0;
                    const height = Math.max(5, count * 20); // Altura m√≠nima 5px
                    
                    html += `
                        <div class="hourly-bar">
                            <div class="bar" style="height: ${height}px;"></div>
                            <div class="hour-label">${hour}h</div>
                            ${count > 0 ? `<div class="hour-count">${count}</div>` : ''}
                        </div>
                    `;
                }
                
                html += `
                        </div>
                    </div>
                `;
                
                // Adicionar detalhes dos navegadores
                html += `
                    <div style="margin-top: 20px;">
                        <h4 style="margin-bottom: 10px; color: #333;">Distribui√ß√£o por Navegador</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                `;
                
                const browsers = [
                    { name: 'Chrome', count: chromeCount, color: '#4285f4' },
                    { name: 'Firefox', count: firefoxCount, color: '#ff9500' },
                    { name: 'Safari', count: safariCount, color: '#1bb1e7' },
                    { name: 'Edge', count: edgeCount, color: '#0078d7' },
                    { name: 'Outros', count: otherBrowserCount, color: '#666' }
                ];
                
                browsers.forEach(browser => {
                    if (browser.count > 0) {
                        html += `
                            <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; border-left: 4px solid ${browser.color};">
                                <div style="font-weight: bold; color: ${browser.color};">${browser.name}</div>
                                <div style="font-size: 24px; font-weight: bold;">${browser.count}</div>
                                <div style="font-size: 12px; color: #666;">visitas</div>
                            </div>
                        `;
                    }
                });
                
                html += `
                        </div>
                    </div>
                `;
                
                // Bot√£o para ver detalhes completos
                html += `
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="filter-btn" onclick="viewDayDetails('${dateKey}')" 
                                style="padding: 10px 20px; font-size: 14px;">
                            üìã Ver Todas as Visitas deste Dia
                        </button>
                    </div>
                `;
                
                document.getElementById('dailyReportContent').innerHTML = html;
                
            } catch (error) {
                console.error('Erro ao carregar relat√≥rio do dia:', error);
                document.getElementById('dailyReportContent').innerHTML = `
                    <p style="text-align: center; color: #f44336; padding: 40px 0;">
                        Erro ao carregar relat√≥rio do dia.<br>
                        <small>Tente novamente mais tarde.</small>
                    </p>
                `;
            }
        }
        
        // Ver detalhes completos de um dia
        function viewDayDetails(dateKey) {
            // Filtrar visitas por data
            const targetDate = new Date(dateKey);
            const filteredVisits = allVisits.filter(visit => {
                try {
                    const visitDate = new Date(visit.timestamp);
                    return visitDate.toDateString() === targetDate.toDateString();
                } catch (e) {
                    return false;
                }
            });
            
            // Abrir aba de visitas com filtro aplicado
            openTab('visits');
            document.getElementById('dateFilter').value = dateKey;
            updateVisitsTable(filteredVisits);
        }
        
        // Mudar m√™s no calend√°rio
        function changeMonth(delta) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
            updateCalendar();
        }
        
        // Ir para hoje no calend√°rio
        function goToToday() {
            currentCalendarDate = new Date();
            selectedCalendarDate = null;
            updateCalendar();
            
            document.getElementById('dailyReportContent').innerHTML = `
                <p style="text-align: center; color: #666; padding: 40px 0;">
                    Clique em um dia no calend√°rio para ver o relat√≥rio detalhado
                </p>
            `;
            
            document.getElementById('selectedDateTitle').textContent = 'Selecione uma data no calend√°rio';
        }

        // ==================== FUN√á√ïES EXISTENTES (Motoristas, Corridas, etc.) ====================
        // [Todas as fun√ß√µes existentes de motoristas, corridas, registros, etc. permanecem aqui]
        // Por quest√£o de espa√ßo, mantive apenas as fun√ß√µes principais e adicionei as novas de calend√°rio
        // As fun√ß√µes restantes continuam exatamente como estavam no c√≥digo original
        
        // Alternar entre abas
        function openTab(tabName) {
            // Remover classe active de todas as tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Esconder todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Mostrar aba selecionada
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Adicionar classe active na tab clicada
            event.target.classList.add('active');
            
            // Se for a aba de tempo real, atualizar gr√°ficos
            if (tabName === 'realtime') {
                updateRealtimeCharts();
            }
            
            // Se for a aba de calend√°rio, atualizar calend√°rio
            if (tabName === 'calendar') {
                updateCalendar();
            }
        }

        // Carregar dados dos motoristas - FUN√á√ÉO OTIMIZADA
        async function loadDriversData() {
            try {
                console.log('üë®‚Äç‚úàÔ∏è Buscando TODOS os motoristas...');
                
                // Buscar de TODAS as fontes poss√≠veis
                const sources = [
                    'drivers_registered',
                    'registered_drivers',
                    'drivers',
                    'motoristas',
                    'taxistas'
                ];
                
                allDrivers = {};
                
                // Buscar de cada fonte
                for (const source of sources) {
                    try {
                        const snapshot = await database.ref(source).once('value');
                        const driversData = snapshot.val() || {};
                        
                        console.log(`üìÅ Fonte "${source}": ${Object.keys(driversData).length} motoristas`);
                        
                        // Processar cada motorista desta fonte
                        Object.entries(driversData).forEach(([driverId, driverData]) => {
                            if (!driverData || typeof driverData !== 'object') return;
                            
                            // Criar objeto do motorista
                            const driver = {
                                driverId: driverId,
                                source: source,
                                sourceBadge: 'üåê',
                                ...driverData
                            };
                            
                            // Verificar se √© um registro completo de motorista
                            if (driverData.name || driverData.username || driverData.phone || driverData.licensePlate) {
                                // Formatar dados
                                driver.name = driverData.name || driverData.nome || driverData.fullName || 'N√£o informado';
                                driver.username = driverData.username || driverData.user || driverData.email || 'N√£o informado';
                                driver.phone = driverData.phone || driverData.telefone || driverData.cellphone || 'N√£o informado';
                                driver.licensePlate = driverData.licensePlate || driverData.matricula || driverData.plate || 'N√£o informada';
                                driver.password = driverData.password || driverData.senha || 'N√£o dispon√≠vel';
                                driver.nif = driverData.nif || driverData.taxId || 'N√£o informado';
                                
                                // Data de cadastro
                                driver.createdAt = driverData.createdAt || driverData.timestamp || driverData.registrationDate || new Date().toISOString();
                                
                                // Status inicial
                                driver.status = 'offline';
                                driver.blocked = false;
                                
                                // Salvar no objeto geral
                                allDrivers[driverId] = driver;
                            }
                        });
                    } catch (error) {
                        console.warn(`‚ö†Ô∏è Erro ao buscar da fonte "${source}":`, error.message);
                    }
                }
                
                // Buscar motoristas online
                try {
                    const onlineSnapshot = await database.ref('drivers').once('value');
                    const onlineDrivers = onlineSnapshot.val() || {};
                    
                    // Atualizar status online
                    Object.entries(onlineDrivers).forEach(([driverId, onlineData]) => {
                        if (allDrivers[driverId]) {
                            allDrivers[driverId].status = onlineData.status || 'offline';
                            if (onlineData.location) {
                                allDrivers[driverId].location = onlineData.location;
                            }
                        }
                    });
                } catch (error) {
                    console.warn('‚ö†Ô∏è Erro ao buscar motoristas online:', error.message);
                }
                
                // Buscar do localStorage
                try {
                    const localDrivers = JSON.parse(localStorage.getItem('gotaxi_drivers') || '{}');
                    Object.entries(localDrivers).forEach(([driverId, localData]) => {
                        if (!allDrivers[driverId]) {
                            // Adicionar motorista local se n√£o existir no Firebase
                            allDrivers[driverId] = {
                                driverId: driverId,
                                ...localData,
                                source: 'local',
                                sourceBadge: 'üíæ',
                                status: 'offline'
                            };
                        }
                        
                        // Aplicar status de bloqueio
                        if (localData.status === 'blocked') {
                            allDrivers[driverId].blocked = true;
                            allDrivers[driverId].status = 'blocked';
                        }
                    });
                } catch (error) {
                    console.warn('‚ö†Ô∏è Erro ao buscar do localStorage:', error.message);
                }
                
                console.log(`‚úÖ Total de motoristas encontrados: ${Object.keys(allDrivers).length}`);
                
                // Atualizar tabela
                updateDriversTable();
                
                if (Object.keys(allDrivers).length > 0) {
                    showNotification(`‚úÖ ${Object.keys(allDrivers).length} motoristas carregados!`, true);
                } else {
                    showNotification('‚ö†Ô∏è Nenhum motorista encontrado!', false);
                }
                
            } catch (error) {
                console.error('üî• ERRO cr√≠tico ao carregar motoristas:', error);
                showNotification('‚ùå Erro ao carregar motoristas!', false);
            }
        }

        // Buscar TODOS os motoristas (fun√ß√£o de for√ßa total)
        async function searchAllDrivers() {
            showNotification('üîç Buscando em todas as fontes...', false);
            await loadDriversData();
        }

        // Mostrar motoristas com senha
        async function showPasswordDrivers() {
            const driversWithPassword = Object.values(allDrivers).filter(driver => 
                driver.password && driver.password !== 'N√£o dispon√≠vel' && driver.password !== ''
            );
            
            if (driversWithPassword.length === 0) {
                showNotification('‚ö†Ô∏è Nenhum motorista com senha dispon√≠vel!', false);
            } else {
                showNotification(`üîë ${driversWithPassword.length} motoristas com senha dispon√≠vel`, true);
                updateDriversTable(driversWithPassword);
            }
        }

        // Atualizar tabela de motoristas
        function updateDriversTable(driversArray = null) {
            const tableBody = document.getElementById('driversTable');
            tableBody.innerHTML = '';
            
            const driversToShow = driversArray || Object.values(allDrivers);
            
            if (!driversToShow || driversToShow.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="no-data">Nenhum motorista cadastrado no sistema</td>
                    </tr>
                `;
                return;
            }
            
            // Ordenar motoristas
            driversToShow.sort((a, b) => {
                // Ordenar por status (online primeiro, depois alfabeticamente)
                const statusOrder = { 'online': 0, 'offline': 1, 'blocked': 2 };
                const aStatus = a.status || 'offline';
                const bStatus = b.status || 'offline';
                
                if (statusOrder[aStatus] !== statusOrder[bStatus]) {
                    return statusOrder[aStatus] - statusOrder[bStatus];
                }
                return (a.name || '').localeCompare(b.name || '');
            });
            
            driversToShow.forEach(driver => {
                const isOnline = driver.status === 'online';
                const isBlocked = driver.blocked === true;
                const hasPassword = driver.password && driver.password !== 'N√£o dispon√≠vel' && driver.password !== '';
                
                // Formatar data de cadastro
                let createdAt = 'N√£o informada';
                try {
                    if (driver.createdAt) {
                        const date = new Date(driver.createdAt);
                        if (!isNaN(date.getTime())) {
                            createdAt = date.toLocaleDateString('pt-PT') + ' ' + date.toLocaleTimeString('pt-PT');
                        }
                    }
                } catch (e) {
                    console.warn('Erro ao formatar data:', e);
                }
                
                // Determinar status
                let statusClass = 'status-offline';
                let statusText = '‚è∏Ô∏è Offline';
                
                if (isBlocked) {
                    statusClass = 'status-blocked';
                    statusText = 'üö´ Bloqueado';
                } else if (isOnline) {
                    statusClass = 'status-online';
                    statusText = '‚úÖ Online';
                }
                
                // Criar linha da tabela
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <strong>${driver.name || 'N√£o informado'}</strong>
                        ${hasPassword ? '<br><small style="color: #4CAF50;">üîë Senha dispon√≠vel</small>' : ''}
                    </td>
                    <td>${driver.username || 'N√£o informado'}</td>
                    <td>${driver.phone || 'N√£o informado'}</td>
                    <td>${driver.licensePlate || 'N√£o informada'}</td>
                    <td>
                        <span class="status-badge ${statusClass}">
                            ${statusText}
                        </span>
                    </td>
                    <td>
                        <span class="source-badge ${driver.source === 'local' ? 'source-local' : 'source-firebase'}">
                            ${driver.sourceBadge || 'üíæ'} ${driver.source === 'local' ? 'Local' : 'Firebase'}
                        </span>
                    </td>
                    <td>${createdAt}</td>
                    <td>
                        <div class="driver-actions">
                            ${hasPassword ? 
                                `<button class="btn btn-view-credentials" onclick="showCredentials('${driver.driverId}')" title="Ver login/senha">üîë Credenciais</button>` : 
                                ''
                            }
                            ${!isBlocked ? 
                                `<button class="btn btn-block" onclick="blockDriver('${driver.driverId}', '${driver.name || 'Motorista'}')" title="Bloquear acesso">üö´ Bloquear</button>` :
                                `<button class="btn btn-unblock" onclick="unblockDriver('${driver.driverId}', '${driver.name || 'Motorista'}')" title="Desbloquear acesso">‚úÖ Desbloquear</button>`
                            }
                            <button class="btn btn-delete" onclick="confirmDeleteDriver('${driver.driverId}', '${driver.name || 'Motorista'}')" title="Remover do sistema">üóëÔ∏è Excluir</button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Carregar dados das corridas
        async function loadRidesData() {
            try {
                console.log('üöï Buscando corridas no Firebase...');
                
                const ridesSnapshot = await database.ref('ride_requests').once('value');
                const ridesData = ridesSnapshot.val() || {};
                
                allRides = [];
                
                Object.entries(ridesData).forEach(([id, ride]) => {
                    try {
                        if (!ride || typeof ride !== 'object') return;
                        
                        const processedRide = {
                            id: id,
                            clientId: ride.clientId || 'Desconhecido',
                            name: ride.name || 'N√£o informado',
                            phone: ride.phone || 'N√£o informado',
                            driverId: ride.driverId || null,
                            driverName: ride.driverName || 'N√£o atribu√≠do',
                            origin: ride.origin || 'N√£o informada',
                            destination: ride.destination || 'N√£o informada',
                            status: ride.status || 'pending',
                            timestamp: ride.timestamp || ride.createdAt || new Date().toISOString(),
                            licensePlate: ride.licensePlate || 'N√£o informada',
                            notes: ride.notes || ''
                        };
                        
                        allRides.push(processedRide);
                        
                    } catch (processError) {
                        console.error(`Erro ao processar corrida ${id}:`, processError);
                    }
                });
                
                allRides.sort((a, b) => {
                    try {
                        return new Date(b.timestamp) - new Date(a.timestamp);
                    } catch (e) {
                        return 0;
                    }
                });
                
                console.log(`‚úÖ ${allRides.length} corridas carregadas com sucesso!`);
                
                updateRidesTable(allRides);
                
                if (allRides.length > 0) {
                    showNotification(`‚úÖ ${allRides.length} corridas carregadas!`, true);
                }
                
            } catch (error) {
                console.error('üî• ERRO ao carregar corridas:', error);
                showNotification('‚ùå Erro ao carregar corridas!', false);
            }
        }

        // Carregar dados de registros
        async function loadRegistrationsData() {
            try {
                console.log('üìù Buscando registros recentes...');
                
                const registrationsSnapshot = await database.ref('admin_notifications')
                    .orderByChild('type')
                    .equalTo('new_driver_registration')
                    .limitToLast(50)
                    .once('value');
                
                const registrationsData = registrationsSnapshot.val() || {};
                
                allRegistrations = [];
                
                Object.entries(registrationsData).forEach(([id, registration]) => {
                    try {
                        if (!registration || typeof registration !== 'object') return;
                        
                        const processedRegistration = {
                            id: id,
                            timestamp: registration.timestamp || registration.registrationDate || new Date().toISOString(),
                            driverName: registration.driverName || 'N√£o informado',
                            driverUsername: registration.driverUsername || 'N√£o informado',
                            licensePlate: registration.licensePlate || 'N√£o informada',
                            nif: registration.nif || 'N√£o informado',
                            driverId: registration.driverId || 'Desconhecido',
                            deviceInfo: registration.deviceInfo || 'Desconhecido',
                            registrationDate: registration.registrationDate || new Date().toISOString()
                        };
                        
                        allRegistrations.push(processedRegistration);
                        
                    } catch (processError) {
                        console.error(`Erro ao processar registro ${id}:`, processError);
                    }
                });
                
                allRegistrations.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                console.log(`‚úÖ ${allRegistrations.length} registros carregados com sucesso!`);
                
                updateRegistrationsTable();
                
            } catch (error) {
                console.error('üî• ERRO ao carregar registros:', error);
                showNotification('‚ùå Erro ao carregar registros!', false);
            }
        }

        // Iniciar monitoramento em tempo real
        function startRealtimeMonitoring() {
            console.log('Iniciando monitoramento em tempo real...');
            
            try {
                // Monitorar estat√≠sticas de visitas em tempo real
                database.ref('visits_stats').on('value', (snapshot) => {
                    const stats = snapshot.val();
                    if (stats) {
                        document.getElementById('totalVisitsStat').textContent = stats.totalVisits || 0;
                        document.getElementById('todayVisitsStat').textContent = stats.todayVisits || 0;
                        
                        const lastUpdate = stats.lastUpdate ? new Date(stats.lastUpdate) : new Date();
                        document.getElementById('lastUpdate').textContent = 
                            `√öltima atualiza√ß√£o: ${lastUpdate.toLocaleTimeString('pt-PT')}`;
                    }
                });
                
                // Monitorar novas visitas em tempo real
                database.ref('visits').limitToLast(1).on('child_added', (snapshot) => {
                    console.log('Nova visita detectada em tempo real!');
                    loadVisitsData(); // Recarregar visitas quando nova for adicionada
                });
                
                // Monitorar novos motoristas em tempo real
                database.ref('drivers_registered').limitToLast(1).on('child_added', (snapshot) => {
                    console.log('Novo motorista detectado em tempo real!');
                    loadDriversData(); // Recarregar motoristas quando novo for adicionado
                });
                
            } catch (error) {
                console.error('Erro ao iniciar monitoramento em tempo real:', error);
            }
        }

        // Atualizar gr√°ficos em tempo real
        function updateRealtimeCharts() {
            const hourlyChart = document.getElementById('hourlyChart');
            const deviceChart = document.getElementById('deviceChart');
            
            // Agrupar visitas por hora do dia (hoje)
            const visitsByHour = {};
            const now = new Date();
            const currentHour = now.getHours();
            
            // Inicializar todas as horas
            for (let i = 0; i < 24; i++) {
                visitsByHour[i] = 0;
            }
            
            // Contar visitas por hora (do dia atual)
            allVisits.forEach(visit => {
                try {
                    const visitDate = new Date(visit.timestamp);
                    if (visitDate.toDateString() === now.toDateString()) {
                        const hour = visitDate.getHours();
                        visitsByHour[hour]++;
                    }
                } catch (e) {
                    // Ignorar erros
                }
            });
            
            // Criar gr√°fico de barras para visitas por hora
            let hourlyHtml = '<div style="display: flex; align-items: flex-end; height: 150px; gap: 2px; padding: 10px;">';
            
            for (let hour = 0; hour < 24; hour++) {
                const count = visitsByHour[hour] || 0;
                const height = Math.max(10, count * 15); // Altura m√≠nima 10px
                const isCurrent = hour === currentHour;
                
                hourlyHtml += `
                    <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                        <div style="background: ${isCurrent ? '#4CAF50' : '#2196F3'}; 
                            width: 90%; height: ${height}px; border-radius: 3px 3px 0 0;"></div>
                        <div style="font-size: 10px; margin-top: 5px; color: #666;">${hour}h</div>
                        ${count > 0 ? `<div style="font-size: 9px; color: #999;">${count}</div>` : ''}
                    </div>
                `;
            }
            
            hourlyHtml += '</div>';
            hourlyChart.innerHTML = hourlyHtml;
            
            // Gr√°fico de dispositivos
            let mobileCount = 0;
            let desktopCount = 0;
            
            allVisits.forEach(visit => {
                if (visit.isMobile === true || (typeof visit.isMobile === 'string' && visit.isMobile.toLowerCase() === 'true')) {
                    mobileCount++;
                } else {
                    desktopCount++;
                }
            });
            
            const totalDevices = mobileCount + desktopCount;
            const mobilePercent = totalDevices > 0 ? Math.round((mobileCount / totalDevices) * 100) : 0;
            const desktopPercent = totalDevices > 0 ? Math.round((desktopCount / totalDevices) * 100) : 0;
            
            let deviceHtml = `
                <div style="display: flex; align-items: center; height: 150px; padding: 20px;">
                    <div style="flex: 1; text-align: center;">
                        <div style="font-size: 40px; margin-bottom: 10px;">üì±</div>
                        <div style="font-weight: bold; font-size: 18px;">${mobileCount}</div>
                        <div style="font-size: 14px; color: #666;">Mobile (${mobilePercent}%)</div>
                    </div>
                    <div style="width: 1px; height: 80px; background: #ddd; margin: 0 20px;"></div>
                    <div style="flex: 1; text-align: center;">
                        <div style="font-size: 40px; margin-bottom: 10px;">üíª</div>
                        <div style="font-weight: bold; font-size: 18px;">${desktopCount}</div>
                        <div style="font-size: 14px; color: #666;">Desktop (${desktopPercent}%)</div>
                    </div>
                </div>
            `;
            
            deviceChart.innerHTML = deviceHtml;
        }

        // Exportar dados
        function exportData() {
            const dataToExport = {
                visits: allVisits,
                drivers: allDrivers,
                rides: allRides,
                registrations: allRegistrations,
                dailyStats: dailyStats,
                exportDate: new Date().toISOString(),
                totalVisits: document.getElementById('totalVisitsStat').textContent,
                todayVisits: document.getElementById('todayVisitsStat').textContent,
                totalDrivers: document.getElementById('totalDriversStat').textContent,
                activeDrivers: document.getElementById('activeDriversStat').textContent
            };
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `gotaxi_export_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Dados exportados com sucesso!', true);
        }

        // Mostrar notifica√ß√£o
        function showNotification(message, isSuccess = true) {
            // Criar elemento de notifica√ß√£o
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: ${isSuccess ? '#4CAF50' : '#f44336'};
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                z-index: 10000;
                font-weight: bold;
                animation: slideIn 0.3s ease;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Remover ap√≥s 3 segundos
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Adicionar estilo CSS para anima√ß√µes
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // Verificar login ao carregar
        window.onload = function() {
            checkAdminLogin();
            // Inicializar data do calend√°rio
            currentCalendarDate = new Date();
        };

        // Inicializar status de conex√£o
        function initConnectionStatus() {
            const statusIndicator = document.getElementById('connectionStatus');
            const statusText = document.getElementById('connectionText');
            
            database.ref('.info/connected').on('value', (snap) => {
                if (snap.val() === true) {
                    statusIndicator.className = 'status-indicator status-connected';
                    statusText.textContent = 'Conectado ao Firebase';
                } else {
                    statusIndicator.className = 'status-indicator status-disconnected';
                    statusText.textContent = 'Desconectado do Firebase';
                }
            });
        }

        // Inicializar quando o documento carregar
        document.addEventListener('DOMContentLoaded', function() {
            initConnectionStatus();
        });

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('credentialsModal');
            if (event.target == modal) {
                closeCredentialsModal();
            }
        };
    </script>
</body>
</html>